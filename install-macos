#!/bin/bash

set -u

find_brew() {
  if [[ $(uname -s) == Darwin ]]; then
    if [[ -x /opt/homebrew/bin/brew ]]; then
      eval "$(/opt/homebrew/bin/brew shellenv)"
    elif [[ -x /usr/local/bin/brew ]]; then
      eval "$(/usr/local/bin/brew shellenv)"
    fi
  else
    if [[ -x /home/linuxbrew/.linuxbrew/bin/brew ]]; then
      eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
    elif [[ -x "$HOME/.linuxbrew/bin/brew" ]]; then
      eval "$("$HOME/.linuxbrew/bin/brew" shellenv)"
    fi
  fi

  if [[ -x "$HOMEBREW_PREFIX/bin/brew" ]]; then
    echo "Using Homebrew at $HOMEBREW_PREFIX"
  else
    echo "Unable to locate Homebrew"
  fi
}

find_brew

if [[ ! -x "$HOMEBREW_PREFIX/bin/brew" ]]; then
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
  echo

  find_brew
fi

brew bundle check || brew bundle install --no-lock
echo
